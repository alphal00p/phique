MODULE Euler_gamma
  ! This is from the cernlib 2006/src/mathlib/gen/c/cgamma64.F
  ! it is same as CGAMMA and WGAMMA
  IMPLICIT NONE
CONTAINS

  FUNCTION CGAMMA(z)
    IMPLICIT NONE
    COMPLEX(KIND(1d0)),INTENT(IN)::z
    COMPLEX(KIND(1d0))::CGAMMA
    REAL(KIND(1d0)),PARAMETER::HF=0.5d0
    REAL(KIND(1d0)),DIMENSION(0:15)::C=(/41.624436916439068D0,&
         -51.224241022374774D0, 11.338755813488977D0,&
         -0.747732687772388D0, 0.008782877493061D0,&
         -0.000001899030264D0, 0.000000001946335D0,&
         -0.000000000199345D0, 0.000000000008433D0,&
         0.000000000001486D0, -0.000000000000806D0,&
         0.000000000000293D0, -0.000000000000102D0,&
         0.000000000000037D0, -0.000000000000014D0,&
         0.000000000000006D0/)
    REAL(KIND(1d0)),PARAMETER::PI=3.14159265358979324D0
    REAL(KIND(1d0)),PARAMETER::C1=2.50662827463100050D0
    REAL(KIND(1d0))::X
    COMPLEX(KIND(1d0))::F,V,H,S
    INTEGER::K
    X=DREAL(Z)
    IF(DIMAG(Z).EQ.0d0.AND.-ABS(X).EQ.INT(X))THEN
       WRITE(*,*)"ERROR: CGAMMA hits the pole !"
       STOP
    ELSE
       IF(X.GE.1d0)THEN
          F=1d0
          V=Z
       ELSEIF(X.GE.0d0)THEN
          F=DREAL(1d0/Z)
          V=1d0+Z
       ELSE
          F=1d0
          V=1d0-Z
       ENDIF
       H=DCMPLX(1d0,0d0)
       S=DCMPLX(C(0),0d0)
       DO K=1,15
          H=((V-K)/(V+(K-1)))*H
          S=S+C(K)*H
       ENDDO
       H=V+(4d0+HF)
       H=C1*EXP((V-HF)*LOG(H)-H)*S
       IF(X.LT.0d0)H=PI/(SIN(PI*Z)*H)
    ENDIF
    CGAMMA=F*H
    RETURN
  END FUNCTION CGAMMA
END MODULE Euler_gamma
